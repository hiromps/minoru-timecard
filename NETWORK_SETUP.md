# ネットワーク設定ガイド

## 現在のネットワーク設定

御社のネットワーク環境に合わせて以下の設定を行いました：

### IPアドレス設定
- **ネットワークレンジ**: 192.168.24.0/24
- **御社PC IPアドレス**: 192.168.24.21
- **サブネットマスク**: 255.255.255.0
- **デフォルトゲートウェイ**: 192.168.24.1

## アクセス制限の仕組み

### 1. 社内ネットワークからのみアクセス可能
`backend/config/allowed-ips.json`で以下のIPレンジを許可：
```json
{
  "allowedIPs": [
    "192.168.24.0/24"  // 192.168.24.1 〜 192.168.24.254 のすべてのIPを許可
  ]
}
```

これにより：
- ✅ 社内の同一ネットワーク（192.168.24.x）からアクセス可能
- ❌ 外部インターネットからアクセス不可
- ❌ 異なるネットワーク（例：192.168.1.x）からアクセス不可

### 2. 管理者ページの追加制限
管理者ページ（/admin）は特定のPCからのみアクセス可能：
```env
ADMIN_ALLOWED_IPS=192.168.24.21
```

## 社内の他のPCからアクセスする方法

### 前提条件
- 同じネットワーク（192.168.24.0/24）に接続していること
- ファイアウォールでポート3000, 3001が開放されていること

### アクセス手順
1. サーバーPCのIPアドレスを確認
   ```cmd
   ipconfig
   ```

2. 他のPCのブラウザから以下にアクセス
   ```
   http://192.168.24.21:3000  # フロントエンド
   http://192.168.24.21:3001  # バックエンドAPI
   ```

### Windows ファイアウォール設定
サーバーPCでポートを開放する必要があります：

```powershell
# 管理者権限でPowerShellを起動して実行

# ポート3000（フロントエンド）を開放
New-NetFirewallRule -DisplayName "Timecard Frontend" -Direction Inbound -Protocol TCP -LocalPort 3000 -Action Allow

# ポート3001（バックエンド）を開放
New-NetFirewallRule -DisplayName "Timecard Backend" -Direction Inbound -Protocol TCP -LocalPort 3001 -Action Allow
```

## サーバーの起動方法

### 開発環境（現在の設定）
```bash
# バックエンド起動
cd backend
npm start

# フロントエンド起動（別ターミナル）
cd ..
npm start
```

### 本番環境での起動
```bash
# 環境変数を本番モードに設定
# backend/.env ファイルで NODE_ENV=production に変更

# PM2を使用した起動（推奨）
npm install -g pm2

# バックエンド
cd backend
pm2 start npm --name "timecard-backend" -- start

# フロントエンド（ビルドして静的ファイルとして配信）
npm run build
pm2 serve build 3000 --name "timecard-frontend"
```

## セキュリティチェックリスト

### ✅ 実装済み
- [x] IP制限による社内ネットワーク限定アクセス
- [x] 管理者ページの追加IP制限
- [x] セッション管理
- [x] CORS制限

### ⚠️ 本番環境で推奨
- [ ] HTTPS証明書の設定
- [ ] 定期的なバックアップ
- [ ] ログ監視
- [ ] セキュリティアップデート

## トラブルシューティング

### Q: 他のPCからアクセスできない
A: 以下を確認してください：
1. 同じネットワーク（192.168.24.x）に接続しているか
2. サーバーPCのファイアウォール設定
3. サーバーが起動しているか（ポート3000, 3001）

### Q: 「アクセスが拒否されました」エラー
A: IPアドレスが許可リストに含まれていない可能性があります。
1. クライアントPCのIPアドレスを確認（ipconfig）
2. `allowed-ips.json`に追加が必要か確認

### Q: 外部からアクセスしたい
A: セキュリティ上推奨しませんが、VPN経由でのアクセスを検討してください。
VPN設定後、VPNのIPレンジを`allowed-ips.json`に追加します。

## 連絡先
技術的な問題が発生した場合は、システム管理者にお問い合わせください。